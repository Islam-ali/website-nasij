@if (items.length > 0) {
<div 
  class="relative w-full carousel-wrapper" 
  #carouselContainer
  [attr.role]="'region'"
  [attr.aria-label]="ariaLabel"
  [attr.aria-roledescription]="'carousel'"
  [attr.tabindex]="keyboardNavigation ? 0 : null"
  (mouseenter)="onMouseEnter($event)"
  (mouseleave)="onMouseLeave($event)"
>
  <div class="overflow-x-hidden overflow-y-visible rounded-xl w-full carousel-container">
    <div 
      #carouselInner
      class="flex transition-transform carousel-inner"
      [style.direction]="isRTL ? 'rtl' : 'ltr'"
      [style.transition-duration]="transitionDuration + 'ms'"
      [style.transition-timing-function]="transitionEasing"
      style="gap: 1rem; touch-action: pan-y;"
      [style.transform]="transformString"
      (mousedown)="onDragStart($event)"
      (touchstart)="onDragStart($event)"
      [class.dragging]="isDragging"
      [attr.aria-live]="'polite'"
      [attr.aria-atomic]="true"
      id="carousel-content"
    >
      @for (product of items; track product._id || product.id || $index) {
        <div 
          class="flex-shrink-0 carousel-item"
          [style.width]="'calc((100% - (' + (itemsPerPage - 1) + ' * 1rem)) / ' + itemsPerPage + ')'"
          [attr.role]="'group'"
          [attr.aria-roledescription]="'slide'"
          [attr.aria-label]="'Slide ' + ($index + 1) + ' of ' + items.length"
          [attr.aria-hidden]="($index < currentIndex || $index >= currentIndex + itemsPerPage) ? 'true' : 'false'"
        >
          <app-product-card 
            (clicked)="onItemClick.emit(product)" 
            [product]="product"
            class="h-full w-full"
          ></app-product-card>
        </div>
      }
    </div>
  </div>
  
  <!-- Enhanced Navigation Controls (Arrows + Dots) -->
  @if ((showArrows || showIndicators) && items.length > itemsPerPage && totalPages > 1) {
    <div class="navigation-controls">
      <!-- Previous Button -->
      @if (showArrows) {
        <button 
          type="button"
          (click)="previous()"
          class="nav-button nav-button-prev"
          [disabled]="!canGoPrevious"
          [attr.aria-label]="isRTL ? 'السابق' : 'Previous slide'"
          [attr.aria-controls]="'carousel-content'"
          [attr.aria-disabled]="!canGoPrevious"
        >
          <i [class]="(isRTL ? 'pi pi-chevron-right' : 'pi pi-chevron-left')"></i>
        </button>
      }

      <!-- Enhanced Indicators/Dots -->
      @if (showIndicators) {
        <div 
          class="indicators-wrapper"
          role="tablist"
          [attr.aria-label]="'Carousel navigation'"
        >
          <div class="indicators">
            @for (page of pagesArray; track $index) {
              <button
                type="button"
                (click)="goToPage($index)"
                class="indicator"
                [class.active]="currentPage === $index"
                [attr.role]="'tab'"
                [attr.aria-label]="'Go to slide ' + ($index + 1) + ' of ' + totalPages"
                [attr.aria-selected]="currentPage === $index ? 'true' : 'false'"
                [attr.aria-controls]="'carousel-content'"
                [attr.tabindex]="currentPage === $index ? 0 : -1"
              >
                <span class="indicator-dot"></span>
              </button>
            }
          </div>
        </div>
      }

      <!-- Next Button -->
      @if (showArrows) {
        <button 
          type="button"
          (click)="next()"
          class="nav-button nav-button-next"
          [disabled]="!canGoNext"
          [attr.aria-label]="isRTL ? 'التالي' : 'Next slide'"
          [attr.aria-controls]="'carousel-content'"
          [attr.aria-disabled]="!canGoNext"
        >
          <i [class]="(isRTL ? 'pi pi-chevron-left' : 'pi pi-chevron-right')"></i>
        </button>
      }
    </div>
  }
</div>
}
