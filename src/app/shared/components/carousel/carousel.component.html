@if (items.length > 0) {
<div 
  class="relative w-full" 
  #carouselContainer
  [attr.role]="'region'"
  [attr.aria-label]="ariaLabel"
  [attr.aria-roledescription]="'carousel'"
  [attr.tabindex]="keyboardNavigation ? 0 : null"
  (mouseenter)="onMouseEnter($event)"
  (mouseleave)="onMouseLeave($event)"
>
  <div class="overflow-hidden rounded-lg w-full">
    <div 
      #carouselInner
      class="flex transition-transform carousel-inner"
      [style.direction]="isRTL ? 'rtl' : 'ltr'"
      [style.transition-duration]="transitionDuration + 'ms'"
      [style.transition-timing-function]="transitionEasing"
      style="gap: 1rem;"
      [style.transform]="getTransform()"
      (mousedown)="onDragStart($event)"
      (touchstart)="onDragStart($event)"
      [class.dragging]="isDragging"
      [attr.aria-live]="'polite'"
      [attr.aria-atomic]="true"
      id="carousel-content"
    >
      @for (product of items; track product._id || product.id || $index) {
        <div 
          class="flex-shrink-0 carousel-item"
          [style.width]="'calc((100% - (' + (itemsPerPage - 1) + ' * 1rem)) / ' + itemsPerPage + ')'"
          [attr.role]="'group'"
          [attr.aria-roledescription]="'slide'"
          [attr.aria-label]="'Slide ' + ($index + 1) + ' of ' + items.length"
          [attr.aria-hidden]="($index < currentIndex || $index >= currentIndex + itemsPerPage) ? 'true' : 'false'"
        >
          <app-product-card 
            (clicked)="onItemClick.emit(product)" 
            [product]="product"
            class="h-full w-full"
          ></app-product-card>
        </div>
      }
    </div>
  </div>
  
  <!-- Navigation Controls (Arrows + Dots) -->
  @if ((showArrows || showIndicators) && items.length > itemsPerPage && totalPages > 1) {
    <div class="flex items-center justify-center gap-4 mt-6">
      <!-- Previous Button -->
      @if (showArrows) {
        <button 
          type="button"
          (click)="previous()"
          class="bg-white dark:bg-gray-800 rounded-full p-2.5 
                 shadow-md hover:shadow-lg transition-all duration-300
                 disabled:opacity-50 disabled:cursor-not-allowed
                 hover:bg-gray-50 dark:hover:bg-gray-700
                 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
          [disabled]="!canGoPrevious"
          [attr.aria-label]="isRTL ? 'السابق' : 'Previous slide'"
          [attr.aria-controls]="'carousel-content'"
          [attr.aria-disabled]="!canGoPrevious"
        >
          <i [class]="(isRTL ? 'pi pi-chevron-right' : 'pi pi-chevron-left') + ' text-base ' + (canGoPrevious ? 'text-gray-700 dark:text-gray-300' : 'text-gray-400 dark:text-gray-600')"></i>
        </button>
      }

      <!-- Indicators/Dots -->
      @if (showIndicators) {
        <div 
          class="flex justify-center gap-2"
          role="tablist"
          [attr.aria-label]="'Carousel navigation'"
        >
          @for (page of pagesArray; track $index) {
            <button
              type="button"
              (click)="goToPage($index)"
              class="rounded-full transition-all duration-300
                     focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
              [class]="currentPage === $index 
                ? 'w-8 h-2 bg-primary-600 dark:bg-primary-500' 
                : 'w-2 h-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500'"
              [attr.role]="'tab'"
              [attr.aria-label]="'Go to slide ' + ($index + 1) + ' of ' + totalPages"
              [attr.aria-selected]="currentPage === $index ? 'true' : 'false'"
              [attr.aria-controls]="'carousel-content'"
              [attr.tabindex]="currentPage === $index ? 0 : -1"
            ></button>
          }
        </div>
      }

      <!-- Next Button -->
      @if (showArrows) {
        <button 
          type="button"
          (click)="next()"
          class="bg-white dark:bg-gray-800 rounded-full p-2.5 
                 shadow-md hover:shadow-lg transition-all duration-300
                 disabled:opacity-50 disabled:cursor-not-allowed
                 hover:bg-gray-50 dark:hover:bg-gray-700
                 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2"
          [disabled]="!canGoNext"
          [attr.aria-label]="isRTL ? 'التالي' : 'Next slide'"
          [attr.aria-controls]="'carousel-content'"
          [attr.aria-disabled]="!canGoNext"
        >
          <i [class]="(isRTL ? 'pi pi-chevron-left' : 'pi pi-chevron-right') + ' text-base ' + (canGoNext ? 'text-gray-700 dark:text-gray-300' : 'text-gray-400 dark:text-gray-600')"></i>
        </button>
      }
    </div>
  }
</div>
}
