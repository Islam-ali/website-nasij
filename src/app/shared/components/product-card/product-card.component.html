<div class="product-card w-full cursor-pointer rounded-2xl overflow-hidden border border-gray-100 dark:border-gray-700 hover:border-primary-300 dark:hover:border-primary-600 hover:shadow-xl transition-all duration-300 group bg-white dark:bg-gray-800"
(click)="navigateToProduct(product)">
  <!-- Image Container -->
  <div class="relative w-full h-[18rem] sm:h-[26rem] overflow-hidden bg-gray-50 dark:bg-gray-900/50">
    <!-- Product Image -->
    <img [src]="getProductImageUrl()" 
      [alt]="product.name | multiLanguage" 
      fallback="images/photo.png"
      width="600" 
      height="800"
      loading="lazy"
      fetchpriority="low"
      decoding="async"
      class="w-full h-full object-contain object-center scale-95 transition-transform duration-500 group-hover:scale-105" />
    
    <!-- Gradient Overlay -->
    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent"></div>
    
    <!-- Sale Badge -->
    @if (isOnSale ) {
    <div class="absolute top-3 left-3 bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-full z-20 ">
      <i class="pi pi-tag mr-1"></i>
      {{ discountPercentage }}% {{ 'products.off' | translate }}
    </div>
    }

    <!-- Stock Status Badge -->
    <!-- @if (product.status && product.status !== productStatus.ACTIVE) {
    <div class="absolute top-3 right-3 bg-gray-400 text-red-500 text-xs font-bold px-3 py-1.5 rounded-full z-20 ">
      <i class="pi pi-times-circle mr-1"></i>
      {{ 'products.out_of_stock' | translate }}
    </div>
    }  -->
    <!-- @else if (product.status === productStatus.ACTIVE) {
    <div class="absolute top-4 right-4 bg-orange-500 dark:bg-orange-600 text-white text-xs font-bold px-3 py-1.5 rounded-full z-20  transition-colors duration-300">
      <i class="pi pi-exclamation-triangle mr-1"></i>
      Only {{ product.stock }} left
    </div>
    } -->

    <!-- Action Buttons -->
    <div class="absolute top-4 right-4 flex flex-col gap-2 z-10 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
    </div>

    <!-- Product Info Overlay -->
    <div class="absolute bottom-0 left-0 right-0 p-4 text-white">
      <!-- Product Variants Selection (Hover Only) -->
      <div class="mb-3 space-y-2 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
        @if (product.variants && product.variants.length > 0 && mappedVariants.length > 0) {
          <div class="space-y-2">
            @for (variant of mappedVariants; track $index) {
            <div class="flex flex-col gap-1.5">
              <span class="text-xs font-semibold text-white/90 dark:text-gray-200">{{ variant.variant | translate }}</span>
              <div class="flex flex-wrap gap-2">
                @for (attribute of variant.attributes; track $index) {
                @if (!attribute.image) {
                <label [for]="'card-' + product._id + '-' + attribute._id" 
                  class="relative cursor-pointer w-max"
                  (click)="$event.stopPropagation()">
                  <input type="radio" 
                    [id]="'card-' + product._id + '-' + attribute._id" 
                    [value]="attribute" 
                    [name]="'variant-' + product._id + '-' + variant.variant"
                    (change)="onVariantSelect(attribute, $event)" 
                    class="sr-only" />
                  <div
                    class="px-2 py-1 rounded-lg border-2 transition-all duration-200 text-center min-w-[50px] text-xs font-semibold"
                    [ngClass]="{ 
                      'border-primary-400 dark:border-primary-300 bg-primary-500/80 dark:bg-primary-600/80 text-white': isVariantSelected(attribute),
                      'border-white/50 dark:border-gray-500 hover:border-white dark:hover:border-gray-400 text-white dark:text-gray-200 bg-white/10 dark:bg-gray-800/30': !isVariantSelected(attribute) 
                    }">
                    <span>{{ attribute.value | multiLanguage }}</span>
                  </div>
                </label>
                }@else {
                <label [for]="'card-' + product._id + '-' + attribute._id"
                  class="relative cursor-pointer w-max rounded-lg overflow-hidden border-2 transition-all duration-200"
                  [ngClass]="{ 
                    'border-primary-400 dark:border-primary-300  ring-2 ring-primary-300 dark:ring-primary-500': isVariantSelected(attribute),
                    'border-white/50 dark:border-gray-500 hover:border-white dark:hover:border-gray-400': !isVariantSelected(attribute) 
                  }"
                  (click)="$event.stopPropagation()">
                  <input type="radio" 
                    [id]="'card-' + product._id + '-' + attribute._id" 
                    [value]="attribute" 
                    [name]="'variant-' + product._id + '-' + variant.variant"
                    (change)="onVariantSelect(attribute, $event)" 
                    class="sr-only" />
                  <div class="w-8 h-8 rounded-lg overflow-hidden">
                    <img [src]="getImageUrl(attribute.image.filePath)" 
                      [alt]="attribute.value | multiLanguage"
                      width="32"
                      height="32"
                      loading="lazy"
                      fetchpriority="low"
                      decoding="async"
                      class="w-full h-full object-cover cursor-pointer transition-transform duration-200 hover:scale-110">
                  </div>
                </label>
                }
                }
              </div>
            </div>
            }
          </div>
          }
      </div>

      <!-- Stock Status (Hover Only) -->
      <div class="mb-3 flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-2 group-hover:translate-y-0">
        @if (product.stock && product.status === productStatus.ACTIVE) {
        <div class="flex items-center gap-1">
          <i class="pi pi-check-circle text-green-300 dark:text-green-400 text-xs"></i>
          <span class="text-xs text-green-200 dark:text-green-300 font-medium">{{ 'products.in_stock' | translate }}</span>
        </div>
        } @else if (product.status && product.status !== productStatus.ACTIVE) {
        <div class="flex items-center gap-1">
          <i class="pi pi-times-circle text-red-300 dark:text-red-400 text-xs"></i>
          <span class="text-xs text-red-200 dark:text-red-300 font-medium">{{ 'products.out_of_stock' | translate }}</span>
        </div>
        }
      </div>

      <!-- Product Title and Price -->
      <div class="flex flex-col gap-2">
        <h3 class="text-sm mb-0 font-bold text-white dark:text-gray-100 leading-tight line-clamp-2 hover:text-primary-200 dark:hover:text-primary-300 transition-colors duration-200 cursor-pointer"
          (click)="navigateToProduct(product)">
          {{ product.name | multiLanguage }}
        </h3>
        
        <!-- Price Section -->
        <div class="flex items-baseline gap-2">
          @if (isOnSale) {
          <span class="text-lg font-bold text-primary-50 dark:text-primary-300">{{ price | currency }}</span>
          <span class="text-sm text-gray-300 dark:text-gray-400 line-through">{{ basePrice | currency }}</span>
          } @else {
          <span class="text-lg font-bold text-primary-50 dark:text-primary-300">{{ price | currency }}</span>
          }
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  @if (loading) {
  <div class="absolute inset-0 bg-white/80 dark:bg-gray-800/80 flex items-center justify-center z-50 rounded-2xl transition-colors duration-300">
    <div class="flex items-center gap-2">
      <div class="w-5 h-5 border-2 border-primary-600 dark:border-primary-400 border-t-transparent rounded-full animate-spin"></div>
      <span class="text-sm font-medium text-gray-700 dark:text-gray-300">Adding to wishlist...</span>
    </div>
  </div>
  }
</div>