<div class="wishlist-container">
  <div class="wishlist-header">
    <h1>My Wishlist</h1>
    @if (wishlistItems.length) {
    <p class="item-count">
      {{ wishlistItems.length }} {{ wishlistItems.length === 1 ? 'item' : 'items' }}
    </p>
    }
  </div>

  <div class="wishlist-content">
    <!-- Loading State -->
    @if (loading) {
    <div class="loading-overlay">
      <ui-spinner></ui-spinner>
    </div>
    }

    <!-- Wishlist Content -->
    @if (!loading) {
      <!-- Empty State -->
      @if (wishlistItems.length === 0) {
      <div class="empty-wishlist">
        <i class="pi pi-heart" style="font-size: 4rem; color: var(--primary-color)"></i>
        <h2>Your wishlist is empty</h2>
        <p>You haven't added any items to your wishlist yet.</p>
        <ui-button variant="outline" size="lg" (click)="continueShopping()">
          <i class="pi pi-arrow-right ml-2"></i>
          Browse Products
        </ui-button>
      </div>
      } @else {
      <div>
        <div class="wishlist-actions mb-4">
          <ui-button variant="ghost" size="md" (click)="continueShopping()">
            <i class="pi pi-arrow-left mr-2"></i>
            Continue Shopping
          </ui-button>
          <ui-button variant="destructive" size="md" (click)="clearWishlist()" [disabled]="loading">
            <i class="pi pi-trash mr-2"></i>
            Clear Wishlist
          </ui-button>
        </div>

        <div class="wishlist-items">
          @for (item of wishlistItems; track trackByItem($index, item)) {
          <div class="wishlist-item">
                <div class="item-image" (click)="viewProduct(item)">
                  <img [src]="getProductImage(item)" [alt]="item?.product?.name || 'Product'" class="product-image" />
                </div>

                <div class="item-details" (click)="viewProduct(item)">
                  <h3 class="product-name">{{ item?.product?.name || 'Product' }}</h3>
                  <div class="product-price">
                    @if (item?.product?.discountPrice) {
                    <span class="discounted-price">
                      {{ getDisplayPrice(item) | currency }}
                    </span>
                    <span class="original-price">
                      {{ item?.product?.price | currency }}
                    </span>
                    } @else {
                    <span>
                      {{ getDisplayPrice(item) | currency }}
                    </span>
                    }
                  </div>
                  <p class="stock-status" [class.in-stock]="isInStock(item)" [class.out-of-stock]="!isInStock(item)">
                    {{ isInStock(item) ? 'In Stock' : 'Out of Stock' }}
                  </p>
                  <!-- select color and size -->
                  <!-- <div class="flex gap-2 flex-col py-2">
                    <div class="flex gap-2 flex-wrap">
                      @if (item.product.sizes) {
                      @for (size of item.product.sizes; track $index) {
                      <button
                        (click)="selectedSize(item, size)"
                        [class.border-primary]="item.size === size"
                        class="px-2 py-1 text-sm border-2 border-gray-300 rounded-lg text-gray-900 bg-gray-100 hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 transform hover:scale-105">
                        {{ size }}
                      </button>
                      }
                      } @else {
                      <p class="text-sm px-2 py-1 text-gray-500 font-medium">One size</p>
                      }
                    </div>
                    <div class="flex gap-2 flex-wrap">
                      @if (item.product.colors) {
                      @for (color of item.product.colors; track $index) {
                      <div (click)="selectedColor(item, color)" [class.border-primary]="item.color === color" [ngStyle]="{ 'background-color': color }"
                        class="w-6 h-6 rounded-full border-2 border-gray-300 cursor-pointer hover:border-gray-500 hover:shadow-md transition-all duration-200 transform hover:scale-110">
                      </div> }
                      } @else {
                      <p class="text-sm px-2 py-1 text-gray-500 font-medium">One color</p>
                      }
                    </div>
                  </div> -->
                </div>

                <div class="item-actions">
                  <ui-button variant="outline" size="md" (click)="$event.stopPropagation(); moveToCart(item)" [disabled]="!item?.product?.stock || loading">
                    <i class="pi pi-shopping-cart mr-2"></i>
                    Add to Cart
                  </ui-button>
                  <ui-button variant="destructive" size="md" [iconOnly]="true" (click)="$event.stopPropagation(); removeFromWishlist(item)" [disabled]="loading">
                    <i class="pi pi-trash"></i>
                  </ui-button>
                </div>
              </div>
          }
        </div>

        <div class="wishlist-footer mt-5">
          <ui-button variant="ghost" size="md" (click)="continueShopping()">
            <i class="pi pi-arrow-left mr-2"></i>
            Continue Shopping
          </ui-button>

          <ui-button variant="primary" size="md" [disabled]="loading" routerLink="/cart">
            View Cart
            <i class="pi pi-shopping-cart ml-2"></i>
          </ui-button>
        </div>
      </div>
      }
    }
  </div>
</div>